services:
  redis:
    image: redis:6.2-alpine
    container_name: redis
    restart: always
    command: redis-server --save 20 1 --loglevel notice
    volumes:
      - redis-cache:/data
    networks:
      - nginx_nginx_goaccess

  goaccess:
    image: goaccess_server
    container_name: goaccess
    restart: always
    command: >
      /app/app.py --external-url=https://goaccess.papaya.local
       --geoip-db=/app/geodb/dbip-city-lite-latest.mmdb/
    networks:
      - nginx_nginx_goaccess
    volumes:
      - data:/app/data
      - /var/geodb/:/app/geodb
    deploy:
      restart_policy:
        condition: on-failure
      resources:
        limits:
          memory: 500M
        reservations:
          memory: 200M
volumes:
  redis-cache:
    driver: local
  data:
    driver: local

networks:
  nginx_nginx_goaccess:
    external: true
